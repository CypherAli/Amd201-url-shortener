<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMD Short link</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Decorative GIF containers -->
    <div class="gif-decorations">
        <div class="gif-item" style="background-image: url('./assets/03db66241697a1c8121d51990d8f6435.gif');"></div>
        <div class="gif-item" style="background-image: url('./assets/arisu-aris.gif');"></div>
        <div class="gif-item" style="background-image: url('./assets/burnice-other-quiality.gif');"></div>
        <div class="gif-item" style="background-image: url('./assets/trickcal-butter.gif');"></div>
        <div class="gif-item" style="background-image: url('./assets/trickcal-chibi-go-kommy.gif');"></div>
        <div class="gif-item" style="background-image: url('./assets/trickcal-trickcal-chibi-go.gif');"></div>
        <div class="gif-item" style="background-image: url('./assets/yBaWlQa.gif');"></div>
        <div class="gif-item" style="background-image: url('./assets/ÂòüÂòüËáâ-ËâæÁàæËä¨.gif');"></div>
    </div>

    <div id="app">
        <div class="header">
            <h1>üîó AMD Short Link</h1>
            <p>Shorten your URLs quickly and easily</p>
        </div>

        <div class="card">
            <div class="auth-section">
                <div class="user-info" v-if="user">
                    <span>üë§ {{ user.email }}</span>
                </div>
                <div v-else>
                    <span style="color: #718096;">Not signed in</span>
                </div>
                <div>
                    <button class="btn btn-secondary" @click="showAuthModal" v-if="!user">Sign In</button>
                    <button class="btn btn-danger" @click="signOut" v-else>Sign Out</button>
                </div>
            </div>

            <div class="tabs" v-if="user">
                <button class="tab" :class="{ active: activeTab === 'shorten' }" @click="activeTab = 'shorten'">
                    Shorten URL
                </button>
                <button class="tab" :class="{ active: activeTab === 'history' }" @click="activeTab = 'history'; loadHistory()">
                    My URLs
                </button>
            </div>

            <div v-if="error" class="error">{{ error }}</div>
            <div v-if="success" class="success">{{ success }}</div>

            <!-- Toast notifications -->
            <div class="toast-container">
                <div v-for="(toast, index) in toasts" :key="index" class="toast" :class="'toast-' + toast.type">
                    <span class="toast-icon">{{ toast.type === 'success' ? '‚úì' : '‚úï' }}</span>
                    <span class="toast-text">{{ toast.message }}</span>
                </div>
            </div>

            <!-- Shorten URL Tab -->
            <div v-show="!user || activeTab === 'shorten'">
                <div v-if="editMode" style="background: #fff3cd; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                    <strong>‚úèÔ∏è Editing URL:</strong> {{ baseUrl }}/{{ editingUrl.shortCode }}
                    <button class="btn btn-secondary" @click="cancelEdit" style="float: right; padding: 5px 15px;">Cancel</button>
                </div>

                <div class="input-group">
                    <label>Long URL</label>
                    <input 
                        :value="editMode ? editOriginalUrl : longUrl"
                        @input="editMode ? (editOriginalUrl = $event.target.value) : (longUrl = $event.target.value)"
                        type="url" 
                        placeholder="https://example.com/very/long/url"
                        @keyup.enter="editMode ? saveEdit() : shortenUrl()"
                    >
                </div>

                <div class="input-group" v-if="user">
                    <label>Custom Short Link (Optional)</label>
                    <input 
                        :value="editMode ? editCustomCode : customCode"
                        @input="editMode ? (editCustomCode = $event.target.value) : (customCode = $event.target.value, checkAvailability())"
                        type="text" 
                        placeholder="my-custom-link"
                        maxlength="20"
                    >
                    <small v-if="!editMode && customCode && isChecking">Checking availability...</small>
                    <small v-if="!editMode && customCode && !isChecking && isAvailable" style="color: #48bb78;">‚úì Available</small>
                    <small v-if="!editMode && customCode && !isChecking && !isAvailable && customCode.length >= 3" style="color: #f56565;">‚úó Already taken</small>
                    <small v-if="!editMode && customCode && customCode.length < 3" style="color: #718096;">Minimum 3 characters</small>
                </div>

                <button class="btn btn-primary" @click="editMode ? saveEdit() : shortenUrl()" :disabled="loading" style="width: 100%;">
                    {{ loading ? (editMode ? 'Updating...' : 'Shortening...') : (editMode ? 'üíæ Save Changes' : 'Shorten URL') }}
                </button>

                <div v-if="shortUrl" class="result">
                    <strong>Your shortened URL:</strong><br>
                    <a :href="shortUrl" target="_blank">{{ shortUrl }}</a>
                    <button class="btn btn-secondary" @click="copyToClipboard" style="margin-left: 10px; padding: 5px 15px;">
                        Copy
                    </button>
                    
                    <!-- QR Code Display -->
                    <div v-if="qrCodeUrl" style="margin-top: 20px; text-align: center; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <strong style="display: block; margin-bottom: 15px; color: #667eea;">üì± Scan QR Code</strong>
                        <img :src="qrCodeUrl" alt="QR Code" style="max-width: 250px; border: 5px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.15); border-radius: 8px;">
                        <div style="margin-top: 15px;">
                            <a :href="qrCodeUrl" download="qrcode.png" class="btn btn-secondary" style="padding: 8px 20px; text-decoration: none;">
                                üíæ Download QR Code
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div v-show="user && activeTab === 'history'">
                <div v-if="historyLoading">Loading...</div>
                <div v-else-if="history.length === 0">
                    <p style="text-align: center; color: #718096; padding: 40px 0;">
                        No URLs yet. Create your first shortened URL!
                    </p>
                </div>
                <div v-else>
                    <div class="history-item" v-for="item in history" :key="item.shortCode">
                        <div class="url-info">
                            <div class="short-code">{{ baseUrl }}/{{ item.shortCode }}</div>
                            <div class="original-url">{{ item.originalUrl }}</div>
                            <small v-if="item.isCustom" style="color: #667eea;">‚ú® Custom</small>
                        </div>
                        <div class="stats">
                            <div>{{ item.clickCount }} clicks</div>
                            <small>{{ formatDate(item.createdAt) }}</small>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-secondary" @click="viewQrCode(item)" style="padding: 5px 10px; margin-right: 5px; font-size: 0.85rem;">
                                    üì± QR
                                </button>
                                <button class="btn btn-secondary" @click="startEdit(item)" style="padding: 5px 10px; margin-right: 5px; font-size: 0.85rem;">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button class="btn btn-danger" @click="deleteUrl(item)" style="padding: 5px 10px; font-size: 0.85rem;">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- QR Code Modal -->
        <div v-if="showQrModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;" @click.self="showQrModal = false">
            <div class="card" style="width: 400px; max-width: 90%; text-align: center;">
                <h2 style="margin-bottom: 20px; color: #667eea;">üì± QR Code</h2>
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);">
                    <img :src="currentQrCode" alt="QR Code" style="max-width: 100%; border: 5px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.15); border-radius: 8px;">
                </div>
                <div style="margin-top: 20px; color: #718096; word-break: break-all; font-size: 0.9rem;">
                    {{ currentShortUrl }}
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <a :href="currentQrCode" download="qrcode.png" class="btn btn-primary" style="text-decoration: none;">
                        üíæ Download
                    </a>
                    <button class="btn btn-secondary" @click="showQrModal = false">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div v-if="showAuth" class="auth-overlay" @click.self="showAuth = false">
            <div class="card auth-modal" :class="'auth-mode-' + authMode">
                <h2 class="auth-title">{{ authMode === 'signin' ? 'Sign In' : 'Create Account' }}</h2>
                <p style="color: #718096; margin-bottom: 25px; font-size: 0.95rem;">
                    {{ authMode === 'signin' ? 'üëã Welcome back! Sign in to your account' : 'üéâ Create a new account to get started' }}
                </p>

                <!-- Social Login Buttons -->
                <button class="btn btn-discord" @click="signInWithDiscord" style="width: 100%; margin-bottom: 10px;">
                    <svg width="18" height="18" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36"><path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/></svg>
                    Continue with Discord
                </button>
                
                <button class="btn btn-github" @click="signInWithGitHub" style="width: 100%; margin-bottom: 20px;">
                    <svg width="18" height="18" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    Continue with GitHub
                </button>

                <div class="divider">
                    <span>or</span>
                </div>

                <div class="input-group">
                    <label>Email</label>
                    <input v-model="authEmail" type="email" placeholder="you@example.com" @keyup.enter="authMode === 'signin' ? signIn() : signUp()">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input v-model="authPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" @keyup.enter="authMode === 'signin' ? signIn() : signUp()">
                </div>

                <button class="btn btn-primary" @click="authMode === 'signin' ? signIn() : signUp()" :disabled="loading" style="width: 100%; margin-bottom: 15px;">
                    {{ loading ? 'Please wait...' : (authMode === 'signin' ? 'Sign In' : 'Sign Up') }}
                </button>

                <div style="text-align: center; color: #718096; font-size: 0.9rem;">
                    {{ authMode === 'signin' ? "Don't have an account?" : "Already have an account?" }}
                    <a href="#" @click.prevent="toggleAuthMode" style="color: #667eea; text-decoration: none; font-weight: 500;">
                        {{ authMode === 'signin' ? 'Sign Up' : 'Sign In' }}
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
